version: "3.7"
services:
  single: # Single container appliances
    image: lnlscon/epics-archiver-single:v1.0-dev
    env_file: 
      - ./.sql.env
    deploy:
      mode: replicated
      replicas: 1
    volumes:
      - ./docker-appliance-images-single/configuration/lnls_appliances.xml:/opt/epics-archiver-appliances/configuration/lnls_appliances.xml:rw
      - ./docker-appliance-images-single/configuration/lnls_policies.py:/opt/epics-archiver-appliances/configuration/lnls_policies.py:ro
    networks:
      - hostnet

  epics-archiver-mysql-db:
    image: lnlscon/epics-archiver-mysql-db:latest
    env_file: 
      - ./.sql.env
    volumes:
      - "/etc/localtime:/etc/localtime:ro"
      - ./db:/var/lib/mysql:rw
    deploy:
      mode: replicated
      replicas: 1
    networks:
      - hostnet

networks:
  hostnet:
    external:
      name: "host"
